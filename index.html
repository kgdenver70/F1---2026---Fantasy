<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Other Car is the Safety Car 2026</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect } = React;

const firebaseConfig = {
  apiKey: "AIzaSyDWVpB2LwzMlCB6EwKV2pSf0PKdzpEiw-A",
  authDomain: "f1-fantasy-2026.firebaseapp.com",
  databaseURL: "https://f1-fantasy-2026-default-rtdb.firebaseio.com",
  projectId: "f1-fantasy-2026",
  storageBucket: "f1-fantasy-2026.firebasestorage.app",
  messagingSenderId: "164030081474",
  appId: "1:164030081474:web:429e56c2961d20d0a00e5b"
};

let db = null;
try {
  firebase.initializeApp(firebaseConfig);
  db = firebase.database();
} catch (e) {
  console.log("Firebase error:", e);
}

function App() {
  const drivers2026 = [
    { position: '1', Driver: { driverId: '4', givenName: 'Lando', familyName: 'Norris' }, Constructors: [{ name: 'McLaren' }] },
    { position: '2', Driver: { driverId: '81', givenName: 'Oscar', familyName: 'Piastri' }, Constructors: [{ name: 'McLaren' }] },
    { position: '3', Driver: { driverId: '16', givenName: 'Charles', familyName: 'Leclerc' }, Constructors: [{ name: 'Ferrari' }] },
    { position: '4', Driver: { driverId: '44', givenName: 'Lewis', familyName: 'Hamilton' }, Constructors: [{ name: 'Ferrari' }] },
    { position: '5', Driver: { driverId: '1', givenName: 'Max', familyName: 'Verstappen' }, Constructors: [{ name: 'Red Bull' }] },
    { position: '6', Driver: { driverId: '6', givenName: 'Isack', familyName: 'Hadjar' }, Constructors: [{ name: 'Red Bull' }] },
    { position: '7', Driver: { driverId: '63', givenName: 'George', familyName: 'Russell' }, Constructors: [{ name: 'Mercedes' }] },
    { position: '8', Driver: { driverId: '12', givenName: 'Kimi', familyName: 'Antonelli' }, Constructors: [{ name: 'Mercedes' }] },
    { position: '9', Driver: { driverId: '14', givenName: 'Fernando', familyName: 'Alonso' }, Constructors: [{ name: 'Aston Martin' }] },
    { position: '10', Driver: { driverId: '18', givenName: 'Lance', familyName: 'Stroll' }, Constructors: [{ name: 'Aston Martin' }] },
    { position: '11', Driver: { driverId: '10', givenName: 'Pierre', familyName: 'Gasly' }, Constructors: [{ name: 'Alpine' }] },
    { position: '12', Driver: { driverId: '43', givenName: 'Franco', familyName: 'Colapinto' }, Constructors: [{ name: 'Alpine' }] },
    { position: '13', Driver: { driverId: '23', givenName: 'Alexander', familyName: 'Albon' }, Constructors: [{ name: 'Williams' }] },
    { position: '14', Driver: { driverId: '55', givenName: 'Carlos', familyName: 'Sainz' }, Constructors: [{ name: 'Williams' }] },
    { position: '15', Driver: { driverId: '87', givenName: 'Oliver', familyName: 'Bearman' }, Constructors: [{ name: 'Haas' }] },
    { position: '16', Driver: { driverId: '31', givenName: 'Esteban', familyName: 'Ocon' }, Constructors: [{ name: 'Haas' }] },
    { position: '17', Driver: { driverId: '30', givenName: 'Liam', familyName: 'Lawson' }, Constructors: [{ name: 'Racing Bulls' }] },
    { position: '18', Driver: { driverId: '45', givenName: 'Arvid', familyName: 'Lindblad' }, Constructors: [{ name: 'Racing Bulls' }] },
    { position: '19', Driver: { driverId: '27', givenName: 'Nico', familyName: 'Hulkenberg' }, Constructors: [{ name: 'Audi' }] },
    { position: '20', Driver: { driverId: '38', givenName: 'Gabriel', familyName: 'Bortoleto' }, Constructors: [{ name: 'Audi' }] },
    { position: '21', Driver: { driverId: '11', givenName: 'Sergio', familyName: 'Perez' }, Constructors: [{ name: 'Cadillac' }] },
    { position: '22', Driver: { driverId: '77', givenName: 'Valtteri', familyName: 'Bottas' }, Constructors: [{ name: 'Cadillac' }] },
  ];

  const constructors2026 = [
    { position: '1', Constructor: { constructorId: 'mclaren', name: 'McLaren' }, engine: 'Mercedes' },
    { position: '2', Constructor: { constructorId: 'ferrari', name: 'Ferrari' }, engine: 'Ferrari' },
    { position: '3', Constructor: { constructorId: 'red_bull', name: 'Red Bull' }, engine: 'Red Bull Ford' },
    { position: '4', Constructor: { constructorId: 'mercedes', name: 'Mercedes' }, engine: 'Mercedes' },
    { position: '5', Constructor: { constructorId: 'aston_martin', name: 'Aston Martin' }, engine: 'Honda' },
    { position: '6', Constructor: { constructorId: 'alpine', name: 'Alpine' }, engine: 'Mercedes' },
    { position: '7', Constructor: { constructorId: 'williams', name: 'Williams' }, engine: 'Mercedes' },
    { position: '8', Constructor: { constructorId: 'haas', name: 'Haas' }, engine: 'Ferrari' },
    { position: '9', Constructor: { constructorId: 'racing_bulls', name: 'Racing Bulls' }, engine: 'Red Bull Ford' },
    { position: '10', Constructor: { constructorId: 'audi', name: 'Audi' }, engine: 'Audi' },
    { position: '11', Constructor: { constructorId: 'cadillac', name: 'Cadillac' }, engine: 'Ferrari' },
  ];

  const raceSchedule = [
    { id: 1, date: 'Mar 6-8', name: 'Australian GP', location: 'Melbourne', pickType: 'Driver', sprint: false },
    { id: 2, date: 'Mar 13-15', name: 'Chinese GP', location: 'Shanghai', pickType: 'Driver', sprint: true },
    { id: 3, date: 'Mar 27-29', name: 'Japanese GP', location: 'Suzuka', pickType: 'Driver', sprint: false },
    { id: 4, date: 'Apr 10-12', name: 'Bahrain GP', location: 'Sakhir', pickType: 'Driver', sprint: false },
    { id: 5, date: 'Apr 17-19', name: 'Saudi Arabian GP', location: 'Jeddah', pickType: 'Driver', sprint: false },
    { id: 6, date: 'May 1-3', name: 'Miami GP', location: 'Miami', pickType: 'Driver', sprint: true },
    { id: 7, date: 'May 22-24', name: 'Canadian GP', location: 'Montreal', pickType: 'Constructor', sprint: true },
    { id: 8, date: 'Jun 5-7', name: 'Monaco GP', location: 'Monaco', pickType: 'Driver', sprint: false },
    { id: 9, date: 'Jun 12-14', name: 'Barcelona GP', location: 'Barcelona', pickType: 'Driver', sprint: false },
    { id: 10, date: 'Jun 26-28', name: 'Austrian GP', location: 'Spielberg', pickType: 'Driver', sprint: true },
    { id: 11, date: 'Jul 3-5', name: 'British GP', location: 'Silverstone', pickType: 'Driver', sprint: false },
    { id: 12, date: 'Jul 17-19', name: 'Belgian GP', location: 'Spa', pickType: 'Driver', sprint: false },
    { id: 13, date: 'Jul 24-26', name: 'Hungarian GP', location: 'Budapest', pickType: 'Driver', sprint: false },
    { id: 14, date: 'Aug 21-23', name: 'Dutch GP', location: 'Zandvoort', pickType: 'Driver', sprint: false },
    { id: 15, date: 'Sep 4-6', name: 'Italian GP', location: 'Monza', pickType: 'Driver', sprint: false },
    { id: 16, date: 'Sep 11-13', name: 'Spanish GP', location: 'Madrid', pickType: 'Driver', sprint: false },
    { id: 17, date: 'Sep 25-26', name: 'Azerbaijan GP', location: 'Baku', pickType: 'Driver', sprint: false },
    { id: 18, date: 'Oct 9-11', name: 'Singapore GP', location: 'Singapore', pickType: 'Constructor', sprint: true },
    { id: 19, date: 'Oct 23-25', name: 'US GP', location: 'Austin', pickType: 'Driver', sprint: true },
    { id: 20, date: 'Oct 30-Nov 1', name: 'Mexico City GP', location: 'Mexico City', pickType: 'Driver', sprint: false },
    { id: 21, date: 'Nov 6-8', name: 'Sao Paulo GP', location: 'Sao Paulo', pickType: 'Driver', sprint: false },
    { id: 22, date: 'Nov 21-22', name: 'Las Vegas GP', location: 'Las Vegas', pickType: 'Driver', sprint: false },
    { id: 23, date: 'Nov 27-29', name: 'Qatar GP', location: 'Losail', pickType: 'Driver', sprint: false },
    { id: 24, date: 'Dec 4-6', name: 'Abu Dhabi GP', location: 'Yas Marina', pickType: 'Driver', sprint: false }
  ];

  const oottDrivers = ['Colapinto', 'Bearman', 'Ocon', 'Stroll', 'Bortoleto', 'Hulkenberg', 'Lawson', 'Lindblad', 'Bottas', 'Perez', 'Hadjar', 'Gasly'];
  const oot6Constructors = ['Aston Martin', 'Haas', 'Audi', 'Cadillac', 'Alpine'];
  const teamColors = {
    'Red Bull': '#3671C6',
    'Ferrari': '#E80020',
    'McLaren': '#FF8000',
    'Mercedes': '#27F4D2',
    'Aston Martin': '#229971',
    'Alpine': '#FF87BC',
    'Williams': '#64C4FF',
    'RB': '#6692FF',
    'Haas': '#B6BABD',
    'Audi': '#00594F',
    'Cadillac': '#D4AF37'
  };
  const getTeamColor = (teamName) => teamColors[teamName] || '#64748b';
  
  // Driver photos - Replace placeholder URLs with actual Wikipedia Commons URLs
  // Format: driverId: 'https://upload.wikimedia.org/wikipedia/commons/...'
  const driverPhotos = {
    '4': 'https://img2.51gt3.com/rac/racer/202503/cfc139b2b49e48cd80a436c00a71711d.png', // Lando Norris
    '81': 'https://img2.51gt3.com/rac/racer/202503/4a3ecd96c2fd49508824cae497bfcec3.png', // Oscar Piastri
    '16': 'https://img2.51gt3.com/rac/racer/202503/fe2de9975d864e38acfd9933164954a6.png', // Charles Leclerc
    '44': 'https://img2.51gt3.com/rac/racer/202503/0ff8ae7649b447bd8e023f4e31dc4042.png', // Lewis Hamilton
    '1': 'https://img2.51gt3.com/rac/racer/202404/736683032ce24f06ba67ce44a2cf0b73.jpg', // Max Verstappen
    '6': 'https://www.redbullracing.com/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fisack-hadjar.a13a3e30.png&w=640&q=75', // Isack Hadjar
    '63': 'https://img2.51gt3.com/rac/racer/202503/f10f01a1704147ca90ab3a4325f38785.png', // George Russell
    '12': 'https://img2.51gt3.com/rac/racer/202503/bcca7f61b6684e26bb28aedaf8d97c53.png', // Kimi Antonelli
    '14': 'https://img2.51gt3.com/rac/racer/202503/25ccca7ffa96437aa54f169a4e9338fa.png', // Fernando Alonso
    '18': 'https://img2.51gt3.com/rac/racer/202503/2869081e10e6412894446d1320c9cb44.png', // Lance Stroll
    '10': 'https://a.espncdn.com/combiner/i?img=/i/headshots/rpm/players/full/5501.png&w=350&h=254', // Pierre Gasly
    '43': 'https://a.espncdn.com/combiner/i?img=/i/headshots/rpm/players/full/5823.png&w=350&h=254', // Franco Colapinto
    '23': 'https://img2.51gt3.com/rac/racer/202503/1f1fd439e5344c7a83faf4a80d09486f.png', // Alexander Albon
    '55': 'https://a.espncdn.com/combiner/i?img=/i/headshots/rpm/players/full/4686.png&w=350&h=254', // Carlos Sainz
    '87': 'https://img2.51gt3.com/rac/racer/202503/b4e1b56f7f2a4c989f16787b26852cba.png', // Oliver Bearman
    '31': 'https://img2.51gt3.com/rac/racer/202503/34d4155677ae4874aae0240f9b366cc3.png', // Esteban Ocon
    '30': 'https://a.espncdn.com/combiner/i?img=/i/headshots/rpm/players/full/5741.png&w=350&h=254', // Liam Lawson
    '45': 'https://encrypted-tbn1.gstatic.com/licensed-image?q=tbn:ANd9GcSYkPKIrhfX9q6lsN_ytLufylPohuB6MeViwy1jKk43JflG-ehMDGLT7kZPsSIYLH3_93iSYUbHoTEzY2s', // Arvid Lindblad
    '27': 'https://a.espncdn.com/combiner/i?img=/i/headshots/rpm/players/full/4396.png&w=350&h=254', // Nico Hulkenberg
    '38': 'https://a.espncdn.com/combiner/i?img=/i/headshots/rpm/players/full/5835.png&w=350&h=254', // Gabriel Bortoleto
    '11': 'https://www.si.com/onsi/f1/news/sergio-perez-confirms-cadillac-f1-test-plan', // Sergio Perez
    '77': 'https://www.cadillacf1team.com/', // Valtteri Bottas
  };
  const getDriverPhoto = (driverId) => driverPhotos[driverId] || '';
  
  // Team logo abbreviations for generating SVG logos
  const teamAbbrev = {
    'Red Bull': 'RB',
    'Ferrari': 'FER',
    'McLaren': 'MCL',
    'Mercedes': 'MER',
    'Aston Martin': 'AM',
    'Alpine': 'ALP',
    'Williams': 'WIL',
    'Racing Bulls': 'RCB',
    'Haas': 'HAAS',
    'Audi': 'AUDI',
    'Cadillac': 'CAD'
  };
  const getTeamAbbrev = (teamName) => teamAbbrev[teamName] || teamName.substring(0, 3).toUpperCase();
  
  // Team Logo component - generates SVG logo with team colors
  const TeamLogo = ({ team, size = 48 }) => {
    const color = getTeamColor(team);
    const abbrev = getTeamAbbrev(team);
    const fontSize = size < 40 ? 10 : size < 60 ? 12 : 14;
    return (
      <svg width={size} height={size} viewBox="0 0 48 48" style={{ borderRadius: '8px', overflow: 'hidden' }}>
        <rect width="48" height="48" fill={color} />
        <text x="24" y="26" textAnchor="middle" dominantBaseline="middle" fill="#fff" fontSize={fontSize} fontWeight="700" fontFamily="system-ui, sans-serif" style={{ textShadow: '0 1px 2px rgba(0,0,0,0.3)' }}>{abbrev}</text>
      </svg>
    );
  };
  
  // Driver Photo component - shows photo or fallback to initials
  const DriverPhoto = ({ driver, size = 48 }) => {
    const [imgError, setImgError] = React.useState(false);
    const photo = getDriverPhoto(driver.driverId);
    const teamColor = getTeamColor(driver.Constructors ? driver.Constructors[0].name : '');
    const initials = driver.givenName.charAt(0) + driver.familyName.charAt(0);
    
    const fallbackStyle = { 
      width: size, 
      height: size, 
      borderRadius: '50%', 
      background: `linear-gradient(135deg, ${teamColor}, ${teamColor}88)`,
      display: 'flex', 
      alignItems: 'center', 
      justifyContent: 'center',
      fontWeight: '700',
      fontSize: size * 0.35,
      color: '#fff',
      textShadow: '0 1px 2px rgba(0,0,0,0.3)',
      border: `2px solid ${teamColor}`,
      flexShrink: 0
    };
    
    if (!photo || imgError) {
      return <div style={fallbackStyle}>{initials}</div>;
    }
    
    return (
      <img 
        src={photo} 
        alt={`${driver.givenName} ${driver.familyName}`}
        style={{ 
          width: size, 
          height: size, 
          borderRadius: '50%', 
          objectFit: 'cover',
          border: `2px solid ${teamColor}`,
          flexShrink: 0
        }}
        onError={() => setImgError(true)}
      />
    );
  };
  
  const ADMIN_PASSWORD = "f1admin2026";

  const [activeTab, setActiveTab] = useState('standings');
  const [currentUser, setCurrentUser] = useState(null);
  const [isAdmin, setIsAdmin] = useState(false);
  const [showAuth, setShowAuth] = useState(true);
  const [authMode, setAuthMode] = useState('login');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [nickname, setNickname] = useState('');
  const [authError, setAuthError] = useState('');
  const [userPicks, setUserPicks] = useState({});
  const [selectedRace, setSelectedRace] = useState(null);
  const [selectedDrivers, setSelectedDrivers] = useState([]);
  const [selectedConstructor, setSelectedConstructor] = useState('');
  const [raceResults, setRaceResults] = useState({});
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [adminTab, setAdminTab] = useState('users');
  const [editingUser, setEditingUser] = useState(null);
  const [selectedRaceForResult, setSelectedRaceForResult] = useState(null);
  const [lockedRaces, setLockedRaces] = useState({});
  const [lockTimes, setLockTimes] = useState({});
  const [editingPick, setEditingPick] = useState(null);
  const [editPickDrivers, setEditPickDrivers] = useState([]);
  const [editPickConstructor, setEditPickConstructor] = useState('');
  const [showChangePassword, setShowChangePassword] = useState(false);
  const [passwordData, setPasswordData] = useState({ current: '', new: '', confirm: '' });
  const [showAvailablePicks, setShowAvailablePicks] = useState(false);
  const [showPointsBreakdown, setShowPointsBreakdown] = useState(false);

  // Check for saved session on load
  useEffect(() => {
    const savedSession = localStorage.getItem('f1PoolSession');
    if (savedSession) {
      try {
        const session = JSON.parse(savedSession);
        if (session.isAdmin) {
          setIsAdmin(true);
          setShowAuth(false);
        } else if (session.userId) {
          // Will be set once users load
          setShowAuth(false);
        }
      } catch (e) { localStorage.removeItem('f1PoolSession'); }
    }
  }, []);

  // Restore user from session after users load
  useEffect(() => {
    const savedSession = localStorage.getItem('f1PoolSession');
    if (savedSession && users.length > 0 && !currentUser && !isAdmin) {
      try {
        const session = JSON.parse(savedSession);
        if (session.userId) {
          const user = users.find(u => u.id === session.userId);
          if (user) { setCurrentUser(user); setShowAuth(false); }
          else { localStorage.removeItem('f1PoolSession'); setShowAuth(true); }
        }
      } catch (e) { localStorage.removeItem('f1PoolSession'); }
    }
  }, [users]);

  useEffect(() => {
    if (!db) {
      setUsers([{ id: '1', email: 'demo1@email.com', password: 'password', nickname: 'SpeedDemon', firstName: 'Demo', lastName: 'User1', points: 0, picks: 0 }, { id: '2', email: 'demo2@email.com', password: 'password', nickname: 'F1Fanatic', firstName: 'Demo', lastName: 'User2', points: 0, picks: 0 }, { id: '3', email: 'demo3@email.com', password: 'password', nickname: 'GridMaster', firstName: 'Demo', lastName: 'User3', points: 0, picks: 0 }]);
      setLoading(false);
      return;
    }
    db.ref('users').on('value', (snapshot) => {
      const data = snapshot.val();
      if (data) { setUsers(Object.values(data)); } else {
        const demoUsers = [{ id: '1', email: 'demo1@email.com', password: 'password', nickname: 'SpeedDemon', firstName: 'Demo', lastName: 'User1', points: 0, picks: 0 }, { id: '2', email: 'demo2@email.com', password: 'password', nickname: 'F1Fanatic', firstName: 'Demo', lastName: 'User2', points: 0, picks: 0 }, { id: '3', email: 'demo3@email.com', password: 'password', nickname: 'GridMaster', firstName: 'Demo', lastName: 'User3', points: 0, picks: 0 }];
        demoUsers.forEach(u => db.ref('users/' + u.id).set(u));
        setUsers(demoUsers);
      }
      setLoading(false);
    });
    db.ref('picks').on('value', (snapshot) => { const data = snapshot.val(); if (data) setUserPicks(data); });
    db.ref('raceResults').on('value', (snapshot) => { const data = snapshot.val(); if (data) setRaceResults(data); });
    db.ref('lockedRaces').on('value', (snapshot) => { const data = snapshot.val(); if (data) setLockedRaces(data); });
    db.ref('lockTimes').on('value', (snapshot) => { const data = snapshot.val(); if (data) setLockTimes(data); });
  }, []);

  const saveUser = (user) => { if (db) db.ref('users/' + user.id).set(user); setUsers(users.map(u => u.id === user.id ? user : u)); };
  const addUser = (user) => { if (db) db.ref('users/' + user.id).set(user); setUsers([...users, user]); };
  const deleteUser = (userId) => { if (db) db.ref('users/' + userId).remove(); setUsers(users.filter(u => u.id !== userId)); };
  const savePicks = (key, pickData) => { if (db) db.ref('picks/' + key).set(pickData); setUserPicks({ ...userPicks, [key]: pickData }); };
  const saveRaceResult = (raceId, result) => { if (db) db.ref('raceResults/' + raceId).set(result); setRaceResults({ ...raceResults, [raceId]: result }); };
  const toggleRaceLock = (raceId) => { const newState = !lockedRaces[raceId]; if (db) db.ref('lockedRaces/' + raceId).set(newState); setLockedRaces({ ...lockedRaces, [raceId]: newState }); };
  const isRaceLocked = (raceId) => lockedRaces[raceId] === true;
  const setRaceLockTime = (raceId, dateTime) => { if (db) db.ref('lockTimes/' + raceId).set(dateTime); setLockTimes({ ...lockTimes, [raceId]: dateTime }); };
  const getCountdown = (raceId) => {
    const lockTime = lockTimes[raceId];
    if (!lockTime) return null;
    const now = new Date();
    const lock = new Date(lockTime);
    const diff = lock - now;
    if (diff <= 0) return 'Locked';
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    if (days > 0) return `${days}d ${hours}h`;
    if (hours > 0) return `${hours}h ${mins}m`;
    return `${mins}m`;
  };
  const getUserPickCount = (userId) => Object.keys(userPicks).filter(k => k.startsWith(userId + '-')).length;
  const getAvailableDrivers = () => {
    if (!currentUser) return [];
    const usedIds = Object.values(userPicks).filter(p => p.oderId === currentUser.id && p.picks && p.picks.drivers).flatMap(p => p.picks.drivers);
    return drivers2026.filter(d => !usedIds.includes(d.Driver.driverId));
  };
  const getAvailableConstructors = () => {
    if (!currentUser) return [];
    const usedNames = Object.values(userPicks).filter(p => p.oderId === currentUser.id && p.picks && p.picks.constructor).map(p => p.picks.constructor);
    return constructors2026.filter(c => !usedNames.includes(c.Constructor.name));
  };
  const getUserPointsBreakdown = () => {
    if (!currentUser) return [];
    const pointsTable = { 1: 27, 2: 21, 3: 20, 4: 19, 5: 18, 6: 17, 7: 16, 8: 15, 9: 14, 10: 13, 11: 12, 12: 11, 13: 10, 14: 9, 15: 8, 16: 7, 17: 6, 18: 5, 19: 4, 20: 3, 21: 2, 22: 1 };
    const breakdown = [];
    Object.entries(userPicks).forEach(([key, pick]) => {
      if (!key.startsWith(currentUser.id + '-')) return;
      const raceId = key.split('-')[1];
      const race = raceSchedule.find(r => r.id.toString() === raceId);
      const result = raceResults[raceId];
      if (!race) return;
      let raceBreakdown = { race: race.name, raceId: race.id, pick: null, position: null, basePoints: 0, multiplier: 1, totalPoints: 0, hasResult: !!result };
      if (pick.picks && pick.picks.drivers && pick.picks.drivers[0]) {
        const driverId = pick.picks.drivers[0];
        const driver = drivers2026.find(d => d.Driver.driverId === driverId);
        const driverName = driver ? driver.Driver.givenName + ' ' + driver.Driver.familyName : driverId;
        raceBreakdown.pick = driverName;
        if (result && result.driverPositions && result.driverPositions[driverId]) {
          const pos = result.driverPositions[driverId].position;
          raceBreakdown.position = pos > 0 ? 'P' + pos : 'DNF';
          raceBreakdown.basePoints = pos > 0 ? (pointsTable[pos] || 0) : 0;
          raceBreakdown.multiplier = isOOTT(driverName) ? 2 : 1;
          raceBreakdown.totalPoints = raceBreakdown.basePoints * raceBreakdown.multiplier;
        }
      }
      if (pick.picks && pick.picks.constructor) {
        const constructorName = pick.picks.constructor;
        raceBreakdown.pick = constructorName;
        if (result && result.driverPositions) {
          const teamDrivers = drivers2026.filter(d => d.Constructors[0].name === constructorName);
          let pts = 0;
          let positions = [];
          teamDrivers.forEach(d => {
            const driverResult = result.driverPositions[d.Driver.driverId];
            if (driverResult && driverResult.position > 0) {
              pts += pointsTable[driverResult.position] || 0;
              positions.push('P' + driverResult.position);
            }
          });
          raceBreakdown.position = positions.join(' + ');
          raceBreakdown.basePoints = pts;
          raceBreakdown.multiplier = isOOT6(constructorName) ? 1 : 0.5;
          raceBreakdown.totalPoints = Math.round(pts * raceBreakdown.multiplier);
        }
      }
      breakdown.push(raceBreakdown);
    });
    return breakdown.sort((a, b) => a.raceId - b.raceId);
  };
  const exportToCSV = () => {
    let csv = 'Poolie,Email,Points,Picks\\n';
    users.forEach(u => { csv += `"${u.nickname}","${u.email}",${u.points || 0},${getUserPickCount(u.id)}\\n`; });
    csv += '\\n\\nRace Results\\n';
    csv += 'Race,';
    users.forEach(u => { csv += `"${u.nickname}",`; });
    csv += '\\n';
    raceSchedule.forEach(race => {
      csv += `"${race.name}",`;
      users.forEach(u => {
        const pick = userPicks[u.id + '-' + race.id];
        if (pick && pick.picks) {
          if (pick.picks.drivers) { const d = drivers2026.find(x => x.Driver.driverId === pick.picks.drivers[0]); csv += `"${d ? d.Driver.familyName : pick.picks.drivers[0]}",`; }
          else if (pick.picks.constructor) { csv += `"${pick.picks.constructor}",`; }
          else { csv += ','; }
        } else { csv += ','; }
      });
      csv += '\\n';
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'f1_pool_export.csv'; a.click();
  };
  const adminSavePick = (userId, raceId, pickType) => {
    const key = userId + '-' + raceId;
    const pickData = { oderId: userId, raceId: raceId, picks: pickType === 'Constructor' ? { constructor: editPickConstructor } : { drivers: [...editPickDrivers] }, timestamp: Date.now() };
    if (db) db.ref('picks/' + key).set(pickData);
    setUserPicks({ ...userPicks, [key]: pickData });
    setEditingPick(null); setEditPickDrivers([]); setEditPickConstructor('');
  };
  const adminDeletePick = (userId, raceId) => {
    const key = userId + '-' + raceId;
    if (db) db.ref('picks/' + key).remove();
    const newPicks = { ...userPicks }; delete newPicks[key]; setUserPicks(newPicks);
  };
  const isOOTT = (name) => oottDrivers.some(d => name.includes(d));
  const isOOT6 = (name) => oot6Constructors.includes(name);

  const handleLogin = () => {
    if (email === 'admin' && password === ADMIN_PASSWORD) { setIsAdmin(true); setShowAuth(false); setAuthError(''); setEmail(''); setPassword(''); localStorage.setItem('f1PoolSession', JSON.stringify({ isAdmin: true })); return; }
    const user = users.find(u => u.email === email && u.password === password);
    if (user) { setCurrentUser(user); setShowAuth(false); setAuthError(''); setEmail(''); setPassword(''); localStorage.setItem('f1PoolSession', JSON.stringify({ userId: user.id })); } else { setAuthError('Invalid email or password'); }
  };

  const handleRegister = () => {
    if (!nickname || nickname.length < 3) { setAuthError('Nickname must be at least 3 characters'); return; }
    if (!email || !email.includes('@')) { setAuthError('Please enter a valid email'); return; }
    if (!password || password.length < 6) { setAuthError('Password must be at least 6 characters'); return; }
    if (password !== confirmPassword) { setAuthError('Passwords do not match'); return; }
    if (users.find(u => u.email === email)) { setAuthError('Email already registered'); return; }
    const newUser = { id: Date.now().toString(), email, password, nickname, points: 0, picks: 0 };
    addUser(newUser); setCurrentUser(newUser); setShowAuth(false); setAuthError('');
    setEmail(''); setPassword(''); setConfirmPassword(''); setNickname('');
  };

  const handleLogout = () => { setCurrentUser(null); setIsAdmin(false); setShowAuth(true); setActiveTab('standings'); localStorage.removeItem('f1PoolSession'); };
  const handleChangePassword = () => {
    if (!passwordData.current || !passwordData.new || !passwordData.confirm) { alert('Please fill in all fields'); return; }
    if (passwordData.new !== passwordData.confirm) { alert('New passwords do not match'); return; }
    if (passwordData.current !== currentUser.password) { alert('Current password is incorrect'); return; }
    if (passwordData.new.length < 4) { alert('New password must be at least 4 characters'); return; }
    const updatedUser = { ...currentUser, password: passwordData.new };
    saveUser(updatedUser);
    setCurrentUser(updatedUser);
    setPasswordData({ current: '', new: '', confirm: '' });
    setShowChangePassword(false);
    alert('Password changed successfully!');
  };

  const savePick = () => {
    if (!selectedRace || !currentUser) return;
    if (isRaceLocked(selectedRace.id)) { alert('This race is now locked. Picks are closed.'); setSelectedRace(null); return; }
    const pickName = selectedRace.pickType === 'Constructor' ? selectedConstructor : selectedDrivers.map(id => { const d = drivers2026.find(x => x.Driver.driverId === id); return d ? d.Driver.givenName + ' ' + d.Driver.familyName : id; }).join(', ');
    if (!window.confirm(`Confirm pick for ${selectedRace.name}:\n\n${pickName}\n\nYou can only use this ${selectedRace.pickType === 'Constructor' ? 'constructor' : 'driver'} once per season!`)) return;
    const key = currentUser.id + '-' + selectedRace.id;
    const pickData = { oderId: currentUser.id, raceId: selectedRace.id, picks: selectedRace.pickType === 'Constructor' ? { constructor: selectedConstructor } : { drivers: [...selectedDrivers] }, timestamp: Date.now() };
    savePicks(key, pickData);
    setSelectedRace(null); setSelectedDrivers([]); setSelectedConstructor('');
  };

  const isDriverPicked = (id) => currentUser && Object.values(userPicks).some(p => p.oderId === currentUser.id && p.picks && p.picks.drivers && p.picks.drivers.includes(id));
  const isConstructorPicked = (name) => currentUser && Object.values(userPicks).some(p => p.oderId === currentUser.id && p.picks && p.picks.constructor === name);
  const getDoublePickCount = () => {
    if (!currentUser) return 0;
    return Object.values(userPicks).filter(p => p.oderId === currentUser.id && p.picks && p.picks.drivers && p.picks.drivers.length === 2).length;
  };
  const getUserPick = (raceId) => currentUser ? userPicks[currentUser.id + '-' + raceId] : null;

  const calculateUserPoints = (userId) => {
    const pointsTable = { 1: 27, 2: 21, 3: 20, 4: 19, 5: 18, 6: 17, 7: 16, 8: 15, 9: 14, 10: 13, 11: 12, 12: 11, 13: 10, 14: 9, 15: 8, 16: 7, 17: 6, 18: 5, 19: 4, 20: 3, 21: 2, 22: 1 };
    let total = 0;
    Object.entries(userPicks).forEach(([key, pick]) => {
      if (!key.startsWith(userId + '-')) return;
      const raceId = key.split('-')[1];
      const result = raceResults[raceId];
      if (!result) return;
      if (pick.picks && pick.picks.drivers) {
        pick.picks.drivers.forEach(driverId => {
          const driverResult = result.driverPositions && result.driverPositions[driverId];
          if (driverResult && driverResult.position > 0) {
            let pts = pointsTable[driverResult.position] || 0;
            const driver = drivers2026.find(d => d.Driver.driverId === driverId);
            if (driver && isOOTT(driver.Driver.givenName + ' ' + driver.Driver.familyName)) pts *= 2;
            total += pts;
          }
        });
      }
      if (pick.picks && pick.picks.constructor) {
        const constructorName = pick.picks.constructor;
        const teamDrivers = drivers2026.filter(d => d.Constructors[0].name === constructorName);
        let constructorPts = 0;
        teamDrivers.forEach(d => {
          const driverResult = result.driverPositions && result.driverPositions[d.Driver.driverId];
          if (driverResult && driverResult.position > 0) {
            constructorPts += pointsTable[driverResult.position] || 0;
          }
        });
        if (!isOOT6(constructorName)) constructorPts = Math.round(constructorPts / 2);
        total += constructorPts;
      }
    });
    return total;
  };

  const recalculateAllPoints = () => { users.forEach(user => { const points = calculateUserPoints(user.id); saveUser({ ...user, points }); }); alert('All points recalculated!'); };

  const s = {
    container: { minHeight: '100vh', background: 'linear-gradient(135deg, #0f172a 0%, #1e293b 100%)', color: 'white', fontFamily: 'system-ui, sans-serif' },
    card: { background: 'rgba(51, 65, 85, 0.4)', borderRadius: '16px', padding: '24px', border: '1px solid rgba(100, 116, 139, 0.3)', marginBottom: '16px' },
    btn: { padding: '12px 24px', borderRadius: '12px', border: 'none', cursor: 'pointer', fontWeight: '600', fontSize: '14px' },
    btnRed: { background: '#dc2626', color: 'white' }, btnGray: { background: 'rgba(71, 85, 105, 0.5)', color: '#cbd5e1' },
    btnGreen: { background: '#16a34a', color: 'white' }, btnBlue: { background: '#2563eb', color: 'white' }, btnOrange: { background: '#ea580c', color: 'white' },
    input: { padding: '14px', background: 'rgba(51, 65, 85, 0.5)', border: '1px solid #475569', borderRadius: '12px', color: 'white', fontSize: '16px', width: '100%', boxSizing: 'border-box', outline: 'none' },
    header: { background: 'linear-gradient(135deg, #b91c1c 0%, #dc2626 50%, #ea580c 100%)', padding: '16px' },
    nav: { background: 'rgba(30, 41, 59, 0.9)', padding: '12px 16px', borderBottom: '1px solid rgba(71, 85, 105, 0.5)', position: 'sticky', top: 0, zIndex: 10 },
    badge: { fontSize: '12px', padding: '4px 10px', borderRadius: '999px', fontWeight: '600' },
    grid: { display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(220px, 1fr))', gap: '12px' },
    table: { width: '100%', borderCollapse: 'collapse' },
    th: { textAlign: 'left', padding: '12px', color: '#94a3b8', borderBottom: '1px solid rgba(100, 116, 139, 0.3)' },
    td: { padding: '12px', borderBottom: '1px solid rgba(100, 116, 139, 0.2)' }
  };

  if (loading) return <div style={{ ...s.container, display: 'flex', alignItems: 'center', justifyContent: 'center' }}><div style={{ textAlign: 'center' }}><div style={{ fontSize: '48px', marginBottom: '16px' }}>üèéÔ∏è</div><p>Loading...</p></div></div>;

  if (showAuth) return (
    <div style={{ ...s.container, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px' }}>
      <div style={{ ...s.card, maxWidth: '400px', width: '100%' }}>
        <div style={{ textAlign: 'center', marginBottom: '32px' }}>
          <div style={{ display: 'inline-block', padding: '16px 28px', background: 'linear-gradient(135deg, #dc2626, #ea580c)', borderRadius: '16px', marginBottom: '16px' }}><span style={{ fontSize: '32px', fontWeight: '900' }}>F1</span></div>
          <h1 style={{ fontSize: '28px', fontWeight: '800', margin: '0 0 4px 0' }}>MY OTHER CAR IS THE SAFETY CAR</h1>
          <p style={{ color: '#f87171', fontWeight: '600', margin: 0 }}>2026 SEASON</p>
          <p style={{ color: '#94a3b8', fontSize: '14px', marginTop: '8px' }}>22 Drivers ‚Ä¢ 11 Teams ‚Ä¢ 24 Races</p>
        </div>
        <div style={{ display: 'flex', background: 'rgba(51, 65, 85, 0.5)', borderRadius: '12px', padding: '4px', marginBottom: '24px' }}>
          <button onClick={() => { setAuthMode('login'); setAuthError(''); }} style={{ ...s.btn, flex: 1, background: authMode === 'login' ? '#dc2626' : 'transparent', color: authMode === 'login' ? 'white' : '#94a3b8' }}>Login</button>
          <button onClick={() => { setAuthMode('register'); setAuthError(''); }} style={{ ...s.btn, flex: 1, background: authMode === 'register' ? '#dc2626' : 'transparent', color: authMode === 'register' ? 'white' : '#94a3b8' }}>Register</button>
        </div>
        {authError && <div style={{ background: 'rgba(127, 29, 29, 0.5)', border: '1px solid #dc2626', color: '#fca5a5', padding: '12px', borderRadius: '12px', marginBottom: '16px', fontSize: '14px' }}>{authError}</div>}
        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
          {authMode === 'register' && <input type="text" placeholder="Nickname" value={nickname} onChange={e => setNickname(e.target.value)} style={s.input} />}
          <input type="text" placeholder={authMode === 'login' ? "Email or 'admin'" : "Email"} value={email} onChange={e => setEmail(e.target.value)} style={s.input} />
          <input type="password" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} style={s.input} />
          {authMode === 'register' && <input type="password" placeholder="Confirm Password" value={confirmPassword} onChange={e => setConfirmPassword(e.target.value)} style={s.input} />}
          <button onClick={authMode === 'login' ? handleLogin : handleRegister} style={{ ...s.btn, ...s.btnRed, width: '100%', padding: '14px', textTransform: 'uppercase', letterSpacing: '1px' }}>{authMode === 'login' ? 'Login' : 'Create Account'}</button>
        </div>
        {authMode === 'login' && <div style={{ marginTop: '24px', textAlign: 'center', background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '16px' }}><p style={{ color: '#94a3b8', fontSize: '14px', margin: 0 }}>Enter your credentials to login</p></div>}
      </div>
    </div>
  );

  if (isAdmin) return (
    <div style={s.container}>
      <header style={{ ...s.header, background: 'linear-gradient(135deg, #7c3aed 0%, #a855f7 100%)' }}>
        <div style={{ maxWidth: '1200px', margin: '0 auto', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}><div style={{ width: '44px', height: '44px', background: 'rgba(255,255,255,0.2)', borderRadius: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: '900' }}>‚öôÔ∏è</div><div><h1 style={{ fontSize: '18px', fontWeight: '800', margin: 0 }}>ADMIN PANEL</h1><p style={{ fontSize: '12px', color: '#e9d5ff', margin: 0 }}>My Other Car is the Safety Car 2026</p></div></div>
          <button onClick={handleLogout} style={{ ...s.btn, background: 'rgba(255,255,255,0.15)', color: 'white' }}>Logout</button>
        </div>
      </header>
      <nav style={s.nav}><div style={{ maxWidth: '1200px', margin: '0 auto', display: 'flex', gap: '8px' }}>{['users', 'results', 'picks'].map(tab => <button key={tab} onClick={() => setAdminTab(tab)} style={{ ...s.btn, ...(adminTab === tab ? s.btnBlue : s.btnGray), textTransform: 'capitalize' }}>{tab === 'results' ? 'Race Results' : tab === 'picks' ? 'View Picks' : tab}</button>)}</div></nav>
      <main style={{ maxWidth: '1200px', margin: '0 auto', padding: '16px' }}>
        {adminTab === 'users' && <div style={s.card}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px', flexWrap: 'wrap', gap: '12px' }}><h2 style={{ fontSize: '22px', fontWeight: '700', margin: 0 }}>üë• Manage Users</h2><div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}><button onClick={() => setEditingUser({ id: Date.now().toString(), email: '', password: '', nickname: '', firstName: '', lastName: '', points: 0, picks: 0, isNew: true })} style={{ ...s.btn, ...s.btnGreen }}>+ Add User</button><button onClick={() => { const emails = users.map(u => u.email).join(','); window.location.href = `mailto:?bcc=${emails}&subject=My Other Car is the Safety Car 2026`; }} style={{ ...s.btn, ...s.btnBlue }}>üìß Email All</button><button onClick={() => { const emails = users.map(u => u.email).join(', '); navigator.clipboard.writeText(emails); alert('Copied ' + users.length + ' emails to clipboard!'); }} style={{ ...s.btn, ...s.btnGray }}>üìã Copy Emails</button><button onClick={exportToCSV} style={{ ...s.btn, ...s.btnBlue }}>üì• Export CSV</button><button onClick={recalculateAllPoints} style={{ ...s.btn, ...s.btnOrange }}>Recalculate All Points</button></div></div>
          {editingUser && <div style={{ background: 'rgba(37, 99, 235, 0.1)', border: '1px solid #2563eb', borderRadius: '12px', padding: '20px', marginBottom: '20px' }}><h3 style={{ margin: '0 0 16px 0' }}>{editingUser.isNew ? '‚ûï Add New User' : `Edit User: ${editingUser.nickname}`}</h3><div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '12px' }}><div><label style={{ fontSize: '12px', color: '#94a3b8' }}>First Name</label><input value={editingUser.firstName || ''} onChange={e => setEditingUser({...editingUser, firstName: e.target.value})} style={s.input} placeholder="Enter first name" /></div><div><label style={{ fontSize: '12px', color: '#94a3b8' }}>Last Name</label><input value={editingUser.lastName || ''} onChange={e => setEditingUser({...editingUser, lastName: e.target.value})} style={s.input} placeholder="Enter last name" /></div><div><label style={{ fontSize: '12px', color: '#94a3b8' }}>Nickname *</label><input value={editingUser.nickname} onChange={e => setEditingUser({...editingUser, nickname: e.target.value})} style={s.input} placeholder="Enter nickname" /></div><div><label style={{ fontSize: '12px', color: '#94a3b8' }}>Email *</label><input value={editingUser.email} onChange={e => setEditingUser({...editingUser, email: e.target.value})} style={s.input} placeholder="Enter email" /></div><div><label style={{ fontSize: '12px', color: '#94a3b8' }}>{editingUser.isNew ? 'Password *' : 'Reset Password (leave blank to keep current)'}</label><input type="text" placeholder={editingUser.isNew ? 'Enter password' : 'New password'} value={editingUser.isNew ? (editingUser.password || '') : (editingUser.newPassword || '')} onChange={e => editingUser.isNew ? setEditingUser({...editingUser, password: e.target.value}) : setEditingUser({...editingUser, newPassword: e.target.value})} style={s.input} /></div>{!editingUser.isNew && <div><label style={{ fontSize: '12px', color: '#94a3b8' }}>Points</label><input type="number" value={editingUser.points} onChange={e => setEditingUser({...editingUser, points: parseInt(e.target.value) || 0})} style={s.input} /></div>}</div><div style={{ marginTop: '12px' }}><label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}><input type="checkbox" checked={editingUser.justForFun || false} onChange={e => setEditingUser({...editingUser, justForFun: e.target.checked})} style={{ width: '18px', height: '18px' }} /><span style={{ color: '#94a3b8' }}>üéÆ Just for Fun (excludes from rankings & payouts)</span></label></div><div style={{ display: 'flex', gap: '12px', marginTop: '16px' }}><button onClick={() => { if (!editingUser.nickname || !editingUser.email) { alert('Please enter nickname and email'); return; } if (editingUser.isNew && !editingUser.password) { alert('Please enter a password'); return; } if (editingUser.isNew && users.find(u => u.email === editingUser.email)) { alert('Email already exists'); return; } const userToSave = {...editingUser}; if (!editingUser.isNew && userToSave.newPassword) { userToSave.password = userToSave.newPassword; } delete userToSave.newPassword; delete userToSave.isNew; saveUser(userToSave); setEditingUser(null); }} style={{ ...s.btn, ...s.btnGreen }}>{editingUser.isNew ? 'Add User' : 'Save'}</button><button onClick={() => setEditingUser(null)} style={{ ...s.btn, ...s.btnGray }}>Cancel</button></div></div>}
          <table style={s.table}><thead><tr><th style={s.th}>Nickname</th><th style={s.th}>Email</th><th style={s.th}>Points</th><th style={s.th}>Picks</th><th style={s.th}>Actions</th></tr></thead><tbody>{users.sort((a,b) => (b.points || 0) - (a.points || 0)).map(user => <tr key={user.id} style={{ opacity: user.justForFun ? 0.7 : 1 }}><td style={s.td}><strong>{user.nickname}</strong>{user.justForFun && <span style={{ marginLeft: '8px', fontSize: '11px', background: 'rgba(96, 165, 250, 0.3)', color: '#60a5fa', padding: '2px 6px', borderRadius: '999px' }}>üéÆ</span>}</td><td style={s.td}>{user.email}</td><td style={s.td}><span style={{ fontSize: '20px', fontWeight: '700' }}>{user.points || 0}</span></td><td style={s.td}>{getUserPickCount(user.id)}/24</td><td style={s.td}><button onClick={() => setEditingUser({...user})} style={{ ...s.btn, ...s.btnBlue, padding: '6px 12px', marginRight: '8px' }}>Edit</button><button onClick={() => { if(window.confirm('Delete user ' + user.nickname + '?')) deleteUser(user.id); }} style={{ ...s.btn, ...s.btnRed, padding: '6px 12px' }}>Delete</button></td></tr>)}</tbody></table>
        </div>}
        {adminTab === 'results' && <div style={s.card}>
          <h2 style={{ fontSize: '22px', fontWeight: '700', margin: '0 0 20px 0' }}>üèÅ Enter Race Results</h2>
          {!selectedRaceForResult ? <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>{raceSchedule.map((race, i) => { const hasResult = raceResults[race.id]; const locked = isRaceLocked(race.id); const lockTime = lockTimes[race.id] || ''; return <div key={race.id} style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '14px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '10px', border: locked ? '1px solid rgba(239, 68, 68, 0.5)' : hasResult ? '1px solid rgba(74, 222, 128, 0.3)' : '1px solid rgba(100, 116, 139, 0.2)' }}><div style={{ flex: '1', minWidth: '200px' }}><span style={{ fontWeight: '700' }}>R{i+1}: {race.name}</span><p style={{ color: '#94a3b8', fontSize: '13px', margin: '4px 0' }}>{race.date} ‚Ä¢ {race.pickType}</p>{hasResult && <span style={{ color: '#4ade80', fontSize: '13px' }}>‚úì Results entered</span>}{locked && <span style={{ color: '#f87171', fontSize: '13px', marginLeft: '8px' }}>üîí Locked</span>}</div><div style={{ display: 'flex', alignItems: 'center', gap: '8px', flexWrap: 'wrap' }}><div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}><span style={{ fontSize: '12px', color: '#94a3b8' }}>‚è±Ô∏è Lock:</span><input type="datetime-local" value={lockTime} onChange={e => setRaceLockTime(race.id, e.target.value)} style={{ ...s.input, padding: '6px 8px', fontSize: '12px', width: '180px' }} /></div><button onClick={() => toggleRaceLock(race.id)} style={{ ...s.btn, ...(locked ? s.btnGreen : s.btnRed), padding: '8px 16px' }}>{locked ? 'üîì Unlock' : 'üîí Lock'}</button><button onClick={() => setSelectedRaceForResult(race)} style={{ ...s.btn, ...(hasResult ? s.btnGreen : s.btnBlue), padding: '8px 16px' }}>{hasResult ? 'Edit' : 'Enter'} Results</button></div></div>; })}</div> : <div>
            <h3 style={{ margin: '0 0 16px 0' }}>{selectedRaceForResult.name} - {selectedRaceForResult.pickType}</h3>
            {selectedRaceForResult.pickType === 'Constructor' ? <div><p style={{ color: '#94a3b8', marginBottom: '16px' }}>Enter driver positions (1-22, 0=DNF). Constructor points will be calculated from their drivers.</p><div style={s.grid}>{drivers2026.map(d => <div key={d.Driver.driverId} style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '8px', padding: '12px' }}><label style={{ fontWeight: '600' }}>{d.Driver.givenName} {d.Driver.familyName}</label><p style={{ color: '#94a3b8', fontSize: '12px', margin: '2px 0 8px 0' }}>{d.Constructors[0].name}</p><input type="number" min="0" max="22" placeholder="Pos" value={(raceResults[selectedRaceForResult.id] && raceResults[selectedRaceForResult.id].driverPositions && raceResults[selectedRaceForResult.id].driverPositions[d.Driver.driverId] && raceResults[selectedRaceForResult.id].driverPositions[d.Driver.driverId].position) || ''} onChange={e => { const pos = parseInt(e.target.value) || 0; const current = raceResults[selectedRaceForResult.id] || { driverPositions: {} }; current.driverPositions = current.driverPositions || {}; current.driverPositions[d.Driver.driverId] = { position: pos }; setRaceResults({ ...raceResults, [selectedRaceForResult.id]: current }); }} style={s.input} /></div>)}</div></div> : <div><p style={{ color: '#94a3b8', marginBottom: '16px' }}>Enter driver positions (1-22, 0=DNF):</p><div style={s.grid}>{drivers2026.map(d => <div key={d.Driver.driverId} style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '8px', padding: '12px' }}><label style={{ fontWeight: '600' }}>{d.Driver.givenName} {d.Driver.familyName}</label><p style={{ color: '#94a3b8', fontSize: '12px', margin: '2px 0 8px 0' }}>{d.Constructors[0].name}</p><input type="number" min="0" max="22" placeholder="Pos" value={(raceResults[selectedRaceForResult.id] && raceResults[selectedRaceForResult.id].driverPositions && raceResults[selectedRaceForResult.id].driverPositions[d.Driver.driverId] && raceResults[selectedRaceForResult.id].driverPositions[d.Driver.driverId].position) || ''} onChange={e => { const pos = parseInt(e.target.value) || 0; const current = raceResults[selectedRaceForResult.id] || { driverPositions: {} }; current.driverPositions = current.driverPositions || {}; current.driverPositions[d.Driver.driverId] = { position: pos }; setRaceResults({ ...raceResults, [selectedRaceForResult.id]: current }); }} style={s.input} /></div>)}</div></div>}
            <div style={{ display: 'flex', gap: '12px', marginTop: '24px' }}><button onClick={() => { saveRaceResult(selectedRaceForResult.id, raceResults[selectedRaceForResult.id]); setSelectedRaceForResult(null); alert('Results saved!'); }} style={{ ...s.btn, ...s.btnGreen }}>Save Results</button><button onClick={() => setSelectedRaceForResult(null)} style={{ ...s.btn, ...s.btnGray }}>Cancel</button></div>
          </div>}
        </div>}
        {adminTab === 'picks' && <div style={s.card}>
          <h2 style={{ fontSize: '22px', fontWeight: '700', margin: '0 0 20px 0' }}>üìã Manage User Picks</h2>
          
          {editingPick && <div style={{ background: 'rgba(37, 99, 235, 0.1)', border: '1px solid #2563eb', borderRadius: '12px', padding: '20px', marginBottom: '20px' }}>
            <h3 style={{ margin: '0 0 16px 0' }}>Edit Pick: {editingPick.userName} - {editingPick.raceName}</h3>
            {editingPick.pickType === 'Constructor' ? <div>
              <p style={{ color: '#94a3b8', marginBottom: '12px' }}>Select Constructor:</p>
              <div style={s.grid}>{constructors2026.map(c => <button key={c.Constructor.constructorId} onClick={() => setEditPickConstructor(c.Constructor.name)} style={{ padding: '12px', borderRadius: '8px', textAlign: 'left', cursor: 'pointer', border: editPickConstructor === c.Constructor.name ? '2px solid #2563eb' : '1px solid rgba(100, 116, 139, 0.3)', background: editPickConstructor === c.Constructor.name ? '#2563eb' : 'rgba(71, 85, 105, 0.3)', color: 'white' }}>{c.Constructor.name}</button>)}</div>
            </div> : <div>
              <p style={{ color: '#94a3b8', marginBottom: '12px' }}>Select Driver(s): {editPickDrivers.length}/2</p>
              <div style={s.grid}>{drivers2026.map(d => { const selected = editPickDrivers.includes(d.Driver.driverId); return <button key={d.Driver.driverId} onClick={() => { if (selected) setEditPickDrivers(editPickDrivers.filter(x => x !== d.Driver.driverId)); else if (editPickDrivers.length < 2) setEditPickDrivers([...editPickDrivers, d.Driver.driverId]); }} style={{ padding: '12px', borderRadius: '8px', textAlign: 'left', cursor: 'pointer', border: selected ? '2px solid #2563eb' : '1px solid rgba(100, 116, 139, 0.3)', background: selected ? '#2563eb' : 'rgba(71, 85, 105, 0.3)', color: 'white' }}>{d.Driver.givenName} {d.Driver.familyName}</button>; })}</div>
            </div>}
            <div style={{ display: 'flex', gap: '12px', marginTop: '16px' }}>
              <button onClick={() => adminSavePick(editingPick.userId, editingPick.raceId, editingPick.pickType)} style={{ ...s.btn, ...s.btnGreen }}>Save Pick</button>
              <button onClick={() => { setEditingPick(null); setEditPickDrivers([]); setEditPickConstructor(''); }} style={{ ...s.btn, ...s.btnGray }}>Cancel</button>
            </div>
          </div>}

          {users.map(user => { 
            return <div key={user.id} style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '16px', marginBottom: '12px' }}>
              <h3 style={{ margin: '0 0 12px 0' }}>{user.nickname} <span style={{ color: '#94a3b8', fontSize: '14px' }}>({user.points || 0} pts) - {getUserPickCount(user.id)}/24 picks</span></h3>
              <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                {raceSchedule.map(race => {
                  const pick = userPicks[user.id + '-' + race.id];
                  const pickDisplay = pick ? (pick.picks && pick.picks.drivers ? pick.picks.drivers.map(id => { const d = drivers2026.find(x => x.Driver.driverId === id); return d ? d.Driver.familyName : id; }).join(', ') : pick.picks && pick.picks.constructor) : null;
                  return <div key={race.id} style={{ background: 'rgba(71, 85, 105, 0.3)', borderRadius: '8px', padding: '10px 14px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '8px' }}>
                    <div><strong style={{ marginRight: '8px' }}>R{race.id}:</strong><span style={{ color: '#94a3b8' }}>{race.name}</span> {pick && <span style={{ color: '#4ade80', marginLeft: '8px' }}>‚Üí {pickDisplay}</span>}{!pick && <span style={{ color: '#64748b', marginLeft: '8px' }}>No pick</span>}</div>
                    <div style={{ display: 'flex', gap: '6px' }}>
                      <button onClick={() => { setEditingPick({ userId: user.id, userName: user.nickname, raceId: race.id, raceName: race.name, pickType: race.pickType }); if (pick && pick.picks) { if (pick.picks.drivers) setEditPickDrivers([...pick.picks.drivers]); if (pick.picks.constructor) setEditPickConstructor(pick.picks.constructor); } }} style={{ ...s.btn, ...s.btnBlue, padding: '4px 10px', fontSize: '12px' }}>{pick ? 'Edit' : 'Add'}</button>
                      {pick && <button onClick={() => { if(window.confirm('Delete this pick?')) adminDeletePick(user.id, race.id); }} style={{ ...s.btn, ...s.btnRed, padding: '4px 10px', fontSize: '12px' }}>Delete</button>}
                    </div>
                  </div>;
                })}
              </div>
            </div>; 
          })}
        </div>}
      </main>
    </div>
  );

  return (
    <div style={s.container}>
      <header style={s.header}><div style={{ maxWidth: '1200px', margin: '0 auto', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '12px' }}><div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}><div style={{ width: '44px', height: '44px', background: 'rgba(255,255,255,0.2)', borderRadius: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: '900', fontSize: '16px' }}>F1</div><div><h1 style={{ fontSize: '18px', fontWeight: '800', margin: 0 }}>SAFETY CAR 2026</h1><p style={{ fontSize: '12px', color: '#fecaca', margin: 0 }}>11 Teams ‚Ä¢ 22 Drivers</p></div></div><div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}><div style={{ background: 'rgba(255,255,255,0.15)', padding: '8px 14px', borderRadius: '10px' }}><span style={{ fontWeight: '700', fontSize: '14px' }}>{currentUser && currentUser.nickname}</span><span style={{ marginLeft: '8px', color: '#fecaca', fontSize: '12px' }}>{currentUser && currentUser.points} pts</span></div><button onClick={() => setShowChangePassword(true)} style={{ ...s.btn, background: 'rgba(255,255,255,0.15)', color: 'white', padding: '10px 16px' }}>‚öôÔ∏è</button><button onClick={handleLogout} style={{ ...s.btn, background: 'rgba(255,255,255,0.15)', color: 'white', padding: '10px 16px' }}>Logout</button></div></div></header>
      
      {showChangePassword && <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.8)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, padding: '20px' }}>
        <div style={{ background: '#1e293b', borderRadius: '16px', padding: '24px', maxWidth: '400px', width: '100%' }}>
          <h3 style={{ margin: '0 0 20px 0', fontSize: '20px' }}>üîê Change Password</h3>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
            <input type="password" placeholder="Current Password" value={passwordData.current} onChange={e => setPasswordData({...passwordData, current: e.target.value})} style={s.input} />
            <input type="password" placeholder="New Password" value={passwordData.new} onChange={e => setPasswordData({...passwordData, new: e.target.value})} style={s.input} />
            <input type="password" placeholder="Confirm New Password" value={passwordData.confirm} onChange={e => setPasswordData({...passwordData, confirm: e.target.value})} style={s.input} />
          </div>
          <div style={{ display: 'flex', gap: '12px', marginTop: '20px' }}>
            <button onClick={handleChangePassword} style={{ ...s.btn, ...s.btnGreen }}>Change Password</button>
            <button onClick={() => { setShowChangePassword(false); setPasswordData({ current: '', new: '', confirm: '' }); }} style={{ ...s.btn, ...s.btnGray }}>Cancel</button>
          </div>
        </div>
      </div>}

      {showAvailablePicks && <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.8)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, padding: '20px', overflowY: 'auto' }}>
        <div style={{ background: '#1e293b', borderRadius: '16px', padding: '24px', maxWidth: '600px', width: '100%', maxHeight: '90vh', overflowY: 'auto' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
            <h3 style={{ margin: 0, fontSize: '20px' }}>üìã My Available Picks</h3>
            <button onClick={() => setShowAvailablePicks(false)} style={{ ...s.btn, ...s.btnGray, padding: '8px 16px' }}>Close</button>
          </div>
          <div style={{ marginBottom: '20px' }}>
            <h4 style={{ color: '#4ade80', margin: '0 0 12px 0' }}>üèéÔ∏è Available Drivers ({getAvailableDrivers().length}/22)</h4>
            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
              {getAvailableDrivers().map(d => {
                const name = d.Driver.givenName + ' ' + d.Driver.familyName;
                const teamColor = getTeamColor(d.Constructors[0].name);
                return <span key={d.Driver.driverId} style={{ background: `${teamColor}33`, borderLeft: `3px solid ${teamColor}`, padding: '6px 12px', borderRadius: '8px', fontSize: '13px' }}>{d.Driver.familyName} {isOOTT(name) && '‚≠ê'}</span>;
              })}
              {getAvailableDrivers().length === 0 && <span style={{ color: '#64748b' }}>All drivers used!</span>}
            </div>
          </div>
          <div>
            <h4 style={{ color: '#c084fc', margin: '0 0 12px 0' }}>üèÅ Available Constructors ({getAvailableConstructors().length}/11)</h4>
            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
              {getAvailableConstructors().map(c => { const teamColor = getTeamColor(c.Constructor.name); return <span key={c.Constructor.constructorId} style={{ background: `${teamColor}33`, borderLeft: `3px solid ${teamColor}`, padding: '6px 12px', borderRadius: '8px', fontSize: '13px', color: teamColor, fontWeight: '600' }}>{c.Constructor.name} {isOOT6(c.Constructor.name) && '‚≠ê'}</span>; })}
              {getAvailableConstructors().length === 0 && <span style={{ color: '#64748b' }}>All constructors used!</span>}
            </div>
          </div>
        </div>
      </div>}

      {showPointsBreakdown && <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.8)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, padding: '20px', overflowY: 'auto' }}>
        <div style={{ background: '#1e293b', borderRadius: '16px', padding: '24px', maxWidth: '700px', width: '100%', maxHeight: '90vh', overflowY: 'auto' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
            <h3 style={{ margin: 0, fontSize: '20px' }}>üìä My Points Breakdown</h3>
            <button onClick={() => setShowPointsBreakdown(false)} style={{ ...s.btn, ...s.btnGray, padding: '8px 16px' }}>Close</button>
          </div>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
            {getUserPointsBreakdown().map(row => (
              <div key={row.raceId} style={{ background: 'rgba(71, 85, 105, 0.3)', borderRadius: '10px', padding: '12px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '8px' }}>
                <div>
                  <span style={{ fontWeight: '600' }}>{row.race}</span>
                  <span style={{ marginLeft: '12px', color: '#94a3b8' }}>{row.pick}</span>
                </div>
                {row.hasResult ? (
                  <div style={{ textAlign: 'right' }}>
                    <span style={{ color: '#94a3b8', marginRight: '8px' }}>{row.position}</span>
                    <span style={{ color: '#94a3b8', marginRight: '8px' }}>{row.basePoints} pts</span>
                    {row.multiplier !== 1 && <span style={{ color: '#4ade80', marginRight: '8px' }}>√ó{row.multiplier}</span>}
                    <span style={{ fontWeight: '700', color: '#4ade80' }}>{row.totalPoints} pts</span>
                  </div>
                ) : (
                  <span style={{ color: '#64748b' }}>Pending</span>
                )}
              </div>
            ))}
            {getUserPointsBreakdown().length === 0 && <p style={{ color: '#64748b', textAlign: 'center' }}>No picks yet</p>}
            <div style={{ marginTop: '16px', padding: '12px', background: 'rgba(74, 222, 128, 0.1)', borderRadius: '10px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <span style={{ fontWeight: '700' }}>Total Points</span>
              <span style={{ fontWeight: '700', fontSize: '24px', color: '#4ade80' }}>{currentUser ? currentUser.points || 0 : 0}</span>
            </div>
          </div>
        </div>
      </div>}

      <nav style={s.nav}><div style={{ maxWidth: '1200px', margin: '0 auto', display: 'flex', gap: '8px', overflowX: 'auto' }}>{['standings', 'picks', 'schedule', 'history', 'rules', 'economics', 'drivers', 'teams'].map(tab => <button key={tab} onClick={() => setActiveTab(tab)} style={{ ...s.btn, ...(activeTab === tab ? s.btnRed : s.btnGray), textTransform: 'capitalize', whiteSpace: 'nowrap' }}>{tab === 'picks' ? 'My Picks' : tab}</button>)}</div></nav>
      <main style={{ maxWidth: '1200px', margin: '0 auto', padding: '16px' }}>
        {activeTab === 'standings' && <div style={s.card}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '12px', marginBottom: '20px' }}>
            <h2 style={{ fontSize: '22px', fontWeight: '700', margin: 0 }}>üèÜ League Standings</h2>
            <div style={{ display: 'flex', gap: '8px' }}>
              <button onClick={() => setShowAvailablePicks(true)} style={{ ...s.btn, ...s.btnBlue, padding: '8px 14px', fontSize: '13px' }}>üìã My Available Picks</button>
              <button onClick={() => setShowPointsBreakdown(true)} style={{ ...s.btn, ...s.btnGreen, padding: '8px 14px', fontSize: '13px' }}>üìä Points Breakdown</button>
            </div>
          </div>
          <table style={s.table}><thead><tr><th style={s.th}>Pos</th><th style={s.th}>Player</th><th style={s.th}>Points</th><th style={s.th}>Picks</th></tr></thead><tbody>{(() => {
            const sortedUsers = users.sort((a, b) => (b.points || 0) - (a.points || 0));
            let realRank = 0;
            return sortedUsers.map((user) => {
              if (!user.justForFun) realRank++;
              const isForFun = user.justForFun;
              const displayRank = isForFun ? '-' : realRank;
              return <tr key={user.id} style={{ background: currentUser && user.id === currentUser.id ? 'rgba(220, 38, 38, 0.1)' : 'transparent', opacity: isForFun ? 0.6 : 1 }}><td style={s.td}>{isForFun ? <span style={{ color: '#64748b' }}>-</span> : <span style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center', width: '30px', height: '30px', borderRadius: '8px', fontWeight: '700', background: displayRank === 1 ? '#fbbf24' : displayRank === 2 ? '#9ca3af' : displayRank === 3 ? '#fb923c' : '#475569', color: displayRank <= 3 ? '#000' : '#fff' }}>{displayRank}</span>}</td><td style={s.td}><div><strong>{user.nickname}</strong>{isForFun && <span style={{ marginLeft: '8px', fontSize: '11px', background: 'rgba(96, 165, 250, 0.3)', color: '#60a5fa', padding: '2px 8px', borderRadius: '999px' }}>üéÆ For Fun</span>}{currentUser && user.id === currentUser.id && <span style={{ marginLeft: '8px', fontSize: '11px', background: 'rgba(220, 38, 38, 0.3)', color: '#fca5a5', padding: '2px 8px', borderRadius: '999px' }}>You</span>}</div>{(user.firstName || user.lastName) && <div style={{ fontSize: '12px', color: '#94a3b8', marginTop: '2px' }}>{user.firstName} {user.lastName}</div>}</td><td style={s.td}><span style={{ fontSize: '20px', fontWeight: '700' }}>{user.points || 0}</span></td><td style={s.td}>{getUserPickCount(user.id)}/24</td></tr>;
            });
          })()}</tbody></table>
        </div>}
        {activeTab === 'picks' && <div style={s.card}><h2 style={{ fontSize: '22px', fontWeight: '700', margin: '0 0 20px 0' }}>üìã My Picks</h2>{!selectedRace ? <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>{raceSchedule.map((race, i) => { const pick = getUserPick(race.id); const locked = isRaceLocked(race.id); const countdown = getCountdown(race.id); return <div key={race.id} style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '14px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '10px', border: pick ? '1px solid rgba(74, 222, 128, 0.3)' : locked ? '1px solid rgba(239, 68, 68, 0.3)' : '1px solid rgba(100, 116, 139, 0.2)' }}><div><div style={{ display: 'flex', alignItems: 'center', gap: '8px', flexWrap: 'wrap' }}><span style={{ fontSize: '11px', fontWeight: '700', background: '#475569', padding: '3px 7px', borderRadius: '4px' }}>R{i + 1}</span><span style={{ fontWeight: '700' }}>{race.name}</span>{locked && <span style={{ fontSize: '11px', background: 'rgba(239, 68, 68, 0.3)', color: '#f87171', padding: '3px 7px', borderRadius: '4px' }}>üîí Locked</span>}{!locked && countdown && <span style={{ fontSize: '11px', background: 'rgba(251, 191, 36, 0.3)', color: '#fbbf24', padding: '3px 7px', borderRadius: '4px' }}>‚è±Ô∏è {countdown}</span>}</div><p style={{ color: '#94a3b8', fontSize: '13px', margin: '4px 0' }}>{race.date} ‚Ä¢ {race.location}</p><span style={{ ...s.badge, background: race.pickType === 'Constructor' ? 'rgba(168, 85, 247, 0.2)' : 'rgba(74, 222, 128, 0.2)', color: race.pickType === 'Constructor' ? '#c084fc' : '#4ade80' }}>{race.pickType === 'Constructor' ? 'Constructor' : 'Driver'}</span>{pick && <p style={{ color: '#4ade80', fontSize: '13px', marginTop: '6px' }}>‚úì {pick.picks && pick.picks.drivers ? pick.picks.drivers.map(id => { const d = drivers2026.find(x => x.Driver.driverId === id); return d ? d.Driver.familyName : id; }).join(', ') : (pick.picks && pick.picks.constructor)}</p>}</div>{!pick && !locked && <button onClick={() => setSelectedRace(race)} style={{ ...s.btn, ...s.btnRed, padding: '8px 16px' }}>Pick</button>}{!pick && locked && <span style={{ color: '#64748b', fontSize: '13px' }}>Picks closed</span>}</div>; })}</div> : <div style={{ background: 'rgba(51, 65, 85, 0.4)', borderRadius: '16px', padding: '20px' }}><h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 4px 0' }}>{selectedRace.name}</h3><p style={{ color: '#94a3b8', margin: '0 0 20px 0' }}>{selectedRace.pickType === 'Constructor' ? 'Pick 1 Constructor' : 'Pick 1 Driver'}</p>{selectedRace.pickType === 'Constructor' ? <div><p style={{ color: '#94a3b8', fontSize: '13px', marginBottom: '12px' }}>üü¢ Available | ‚ö´ Used | ‚≠ê OOT6 (2x)</p><div style={s.grid}>{constructors2026.map(c => { const picked = isConstructorPicked(c.Constructor.name); const selected = selectedConstructor === c.Constructor.name; const teamColor = getTeamColor(c.Constructor.name); return <button key={c.Constructor.constructorId} onClick={() => { if (picked) return; setSelectedConstructor(c.Constructor.name); }} disabled={picked} style={{ padding: '14px', borderRadius: '12px', textAlign: 'left', cursor: picked ? 'not-allowed' : 'pointer', border: selected ? '2px solid #dc2626' : `2px solid ${teamColor}`, background: picked ? 'rgba(30, 41, 59, 0.5)' : selected ? '#dc2626' : `${teamColor}22`, color: picked ? '#64748b' : 'white', position: 'relative' }}><div style={{ fontWeight: '700', color: selected ? 'white' : teamColor }}>{c.Constructor.name}</div><div style={{ display: 'flex', gap: '6px', marginTop: '6px', flexWrap: 'wrap' }}><span style={{ fontSize: '11px', background: teamColor, padding: '2px 6px', borderRadius: '4px', color: '#fff' }}>#{c.position}</span>{isOOT6(c.Constructor.name) && <span style={{ fontSize: '11px', background: '#7c3aed', padding: '2px 6px', borderRadius: '4px' }}>2x</span>}</div>{picked && <div style={{ position: 'absolute', inset: 0, background: 'rgba(15, 23, 42, 0.7)', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}><span style={{ fontSize: '11px', background: '#475569', padding: '4px 10px', borderRadius: '999px' }}>Used</span></div>}</button>; })}</div></div> : <div><p style={{ color: '#94a3b8', fontSize: '13px', marginBottom: '12px' }}>üü¢ Available | ‚ö´ Used | ‚≠ê OOTT (2x)</p><div style={s.grid}>{drivers2026.map(d => { const id = d.Driver.driverId; const name = d.Driver.givenName + ' ' + d.Driver.familyName; const picked = isDriverPicked(id); const selected = selectedDrivers.includes(id); const max = 1; const teamColor = getTeamColor(d.Constructors[0].name); return <button key={id} onClick={() => { if (picked) return; if (selected) setSelectedDrivers(selectedDrivers.filter(x => x !== id)); else if (selectedDrivers.length < max) setSelectedDrivers([...selectedDrivers, id]); }} disabled={picked || (!selected && selectedDrivers.length >= max)} style={{ padding: '14px', borderRadius: '12px', textAlign: 'left', cursor: picked ? 'not-allowed' : 'pointer', border: selected ? '2px solid #dc2626' : `2px solid ${teamColor}`, background: picked ? 'rgba(30, 41, 59, 0.5)' : selected ? '#dc2626' : `${teamColor}22`, color: picked ? '#64748b' : 'white', position: 'relative' }}><div style={{ fontWeight: '600' }}>{name} {isOOTT(name) && '‚≠ê'}</div><div style={{ fontSize: '13px', color: selected ? '#fecaca' : teamColor, marginTop: '4px', fontWeight: '600' }}>{d.Constructors[0].name}</div>{picked && <div style={{ position: 'absolute', inset: 0, background: 'rgba(15, 23, 42, 0.7)', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}><span style={{ fontSize: '11px', background: '#475569', padding: '4px 10px', borderRadius: '999px' }}>Used</span></div>}{selected && <div style={{ position: 'absolute', top: '8px', right: '8px', width: '22px', height: '22px', background: 'white', color: '#dc2626', borderRadius: '999px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: '700', fontSize: '11px' }}>‚úì</div>}</button>; })}</div></div>}<div style={{ display: 'flex', gap: '12px', marginTop: '20px' }}><button onClick={savePick} disabled={(selectedRace.pickType === 'Constructor' && !selectedConstructor) || (selectedRace.pickType !== 'Constructor' && selectedDrivers.length === 0)} style={{ ...s.btn, ...s.btnGreen, opacity: ((selectedRace.pickType === 'Constructor' && !selectedConstructor) || (selectedRace.pickType !== 'Constructor' && selectedDrivers.length === 0)) ? 0.5 : 1 }}>Confirm</button><button onClick={() => { setSelectedRace(null); setSelectedDrivers([]); setSelectedConstructor(''); }} style={{ ...s.btn, ...s.btnGray }}>Cancel</button></div></div>}</div>}
        {activeTab === 'schedule' && <div style={s.card}><h2 style={{ fontSize: '22px', fontWeight: '700', margin: '0 0 20px 0' }}>üìÖ 2026 Calendar</h2><div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>{raceSchedule.map((race, i) => <div key={race.id} style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '14px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '10px' }}><div style={{ display: 'flex', alignItems: 'center', gap: '14px' }}><span style={{ fontSize: '20px', fontWeight: '800', color: '#475569', width: '36px' }}>{i + 1}</span><div><span style={{ fontWeight: '700' }}>{race.name}</span>{race.sprint && <span style={{ marginLeft: '8px', fontSize: '11px', background: 'rgba(168, 85, 247, 0.3)', color: '#c084fc', padding: '2px 8px', borderRadius: '4px' }}>‚ö° Sprint</span>}<p style={{ color: '#94a3b8', fontSize: '13px', margin: '2px 0 0 0' }}>{race.location} ‚Ä¢ {race.date}</p></div></div><span style={{ ...s.badge, background: race.pickType === 'Constructor' ? '#7c3aed' : '#16a34a' }}>{race.pickType === 'Constructor' ? 'Constructor' : 'Driver'}</span></div>)}</div></div>}

        {activeTab === 'history' && <div style={s.card}>
          <h2 style={{ fontSize: '22px', fontWeight: '700', margin: '0 0 20px 0' }}>üìú Race History & Results</h2>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
            {raceSchedule.map((race, i) => {
              const result = raceResults[race.id];
              const hasResult = result && result.driverPositions;
              
              // Calculate race winner (highest finishing position among all poolies)
              let raceWinners = [];
              if (hasResult) {
                const pointsTable = { 1: 27, 2: 21, 3: 20, 4: 19, 5: 18, 6: 17, 7: 16, 8: 15, 9: 14, 10: 13, 11: 12, 12: 11, 13: 10, 14: 9, 15: 8, 16: 7, 17: 6, 18: 5, 19: 4, 20: 3, 21: 2, 22: 1 };
                let bestPos = 999;
                users.forEach(user => {
                  const pick = userPicks[user.id + '-' + race.id];
                  if (!pick || !pick.picks) return;
                  let userBestPos = 999;
                  if (pick.picks.drivers && pick.picks.drivers[0]) {
                    const driverResult = result.driverPositions[pick.picks.drivers[0]];
                    if (driverResult && driverResult.position > 0) userBestPos = driverResult.position;
                  }
                  if (pick.picks.constructor) {
                    const teamDrivers = drivers2026.filter(d => d.Constructors[0].name === pick.picks.constructor);
                    teamDrivers.forEach(d => {
                      const driverResult = result.driverPositions[d.Driver.driverId];
                      if (driverResult && driverResult.position > 0 && driverResult.position < userBestPos) {
                        userBestPos = driverResult.position;
                      }
                    });
                  }
                  if (userBestPos < bestPos) { bestPos = userBestPos; raceWinners = [user.nickname]; }
                  else if (userBestPos === bestPos && userBestPos < 999) { raceWinners.push(user.nickname); }
                });
              }
              
              return (
                <div key={race.id} style={{ background: hasResult ? 'rgba(74, 222, 128, 0.05)' : 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '16px', border: hasResult ? '1px solid rgba(74, 222, 128, 0.2)' : '1px solid rgba(100, 116, 139, 0.2)' }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: hasResult ? '12px' : 0 }}>
                    <div>
                      <span style={{ fontWeight: '700' }}>R{i + 1}: {race.name}</span>
                      {race.sprint && <span style={{ marginLeft: '8px', fontSize: '11px', background: 'rgba(168, 85, 247, 0.3)', color: '#c084fc', padding: '2px 8px', borderRadius: '4px' }}>‚ö° Sprint</span>}
                    </div>
                    {hasResult ? <span style={{ color: '#4ade80', fontSize: '13px' }}>‚úì Complete</span> : <span style={{ color: '#64748b', fontSize: '13px' }}>Upcoming</span>}
                  </div>
                  {hasResult && (
                    <div>
                      <div style={{ marginBottom: '8px' }}>
                        <span style={{ color: '#fbbf24', fontSize: '14px', fontWeight: '600' }}>üèÜ Weekly Winner: </span>
                        <span style={{ color: '#fbbf24' }}>{raceWinners.length > 0 ? raceWinners.join(', ') : 'No picks'}</span>
                      </div>
                      <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>
                        {users.map(user => {
                          const pick = userPicks[user.id + '-' + race.id];
                          if (!pick || !pick.picks) return null;
                          let pickName = '';
                          let pos = '';
                          if (pick.picks.drivers && pick.picks.drivers[0]) {
                            const driver = drivers2026.find(d => d.Driver.driverId === pick.picks.drivers[0]);
                            pickName = driver ? driver.Driver.familyName : pick.picks.drivers[0];
                            const driverResult = result.driverPositions[pick.picks.drivers[0]];
                            pos = driverResult && driverResult.position > 0 ? 'P' + driverResult.position : '';
                          }
                          if (pick.picks.constructor) {
                            pickName = pick.picks.constructor;
                          }
                          return (
                            <span key={user.id} style={{ background: 'rgba(71, 85, 105, 0.4)', padding: '4px 10px', borderRadius: '6px', fontSize: '12px' }}>
                              {user.nickname}: {pickName} {pos && <span style={{ color: '#4ade80' }}>{pos}</span>}
                            </span>
                          );
                        })}
                      </div>
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        </div>}

        {activeTab === 'rules' && <div style={s.card}>
          <h2 style={{ fontSize: '22px', fontWeight: '700', margin: '0 0 20px 0' }}>üìñ 2026 Season Rules</h2>
          
          <div style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '20px', marginBottom: '16px' }}>
            <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 12px 0', color: '#4ade80' }}>üèéÔ∏è How It Works</h3>
            <p style={{ color: '#cbd5e1', lineHeight: '1.6', margin: 0 }}>Each race weekend, you'll pick either <strong>1 Driver</strong> or <strong>1 Constructor</strong> depending on the race type. You can only use each driver and constructor <strong>once per season</strong>, so choose wisely! There are <strong>22 Driver races</strong> and <strong>2 Constructor races</strong> (Canadian GP & Singapore GP).</p>
          </div>

          <div style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '20px', marginBottom: '16px' }}>
            <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 12px 0', color: '#60a5fa' }}>üìä Driver Points (per driver)</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(80px, 1fr))', gap: '8px', marginBottom: '12px' }}>
              {[{p:1,pts:27},{p:2,pts:21},{p:3,pts:20},{p:4,pts:19},{p:5,pts:18},{p:6,pts:17},{p:7,pts:16},{p:8,pts:15},{p:9,pts:14},{p:10,pts:13},{p:11,pts:12},{p:12,pts:11},{p:13,pts:10},{p:14,pts:9},{p:15,pts:8},{p:16,pts:7},{p:17,pts:6},{p:18,pts:5},{p:19,pts:4},{p:20,pts:3},{p:21,pts:2},{p:22,pts:1}].map(x => <div key={x.p} style={{ background: 'rgba(71, 85, 105, 0.4)', borderRadius: '8px', padding: '8px', textAlign: 'center' }}><div style={{ fontSize: '12px', color: '#94a3b8' }}>P{x.p}</div><div style={{ fontWeight: '700' }}>{x.pts}</div></div>)}
            </div>
          </div>

          <div style={{ background: 'rgba(74, 222, 128, 0.1)', border: '1px solid rgba(74, 222, 128, 0.3)', borderRadius: '12px', padding: '20px', marginBottom: '16px' }}>
            <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 12px 0', color: '#4ade80' }}>‚≠ê OOTT Drivers (Out Of The Top) - 2x POINTS!</h3>
            <p style={{ color: '#cbd5e1', lineHeight: '1.6', margin: '0 0 12px 0' }}>These drivers earn <strong>DOUBLE POINTS</strong> when picked:</p>
            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
              {oottDrivers.map(d => <span key={d} style={{ background: 'rgba(74, 222, 128, 0.2)', color: '#4ade80', padding: '4px 12px', borderRadius: '999px', fontSize: '13px', fontWeight: '600' }}>{d}</span>)}
            </div>
          </div>

          <div style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '20px', marginBottom: '16px' }}>
            <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 12px 0', color: '#c084fc' }}>üèÅ Constructor Points</h3>
            <p style={{ color: '#cbd5e1', lineHeight: '1.6', margin: '0 0 12px 0' }}>For constructor races, points are calculated by:</p>
            <ol style={{ color: '#cbd5e1', lineHeight: '1.8', margin: '0 0 12px 0', paddingLeft: '20px' }}>
              <li>Add both drivers' finishing position points together</li>
              <li><strong>Top 6 teams:</strong> Divide total by 2</li>
              <li><strong>OOT6 teams:</strong> Keep full points (no division!)</li>
            </ol>
            <p style={{ color: '#94a3b8', fontSize: '14px', margin: 0 }}><em>Example: Ferrari P2 + P4 = (21+19) √∑ 2 = <strong>20 pts</strong></em><br/><em>Example: Alpine P2 + P4 = (21+19) = <strong>40 pts</strong> (OOT6 bonus!)</em></p>
          </div>

          <div style={{ background: 'rgba(168, 85, 247, 0.1)', border: '1px solid rgba(168, 85, 247, 0.3)', borderRadius: '12px', padding: '20px', marginBottom: '16px' }}>
            <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 12px 0', color: '#c084fc' }}>‚≠ê OOT6 Constructors - 2x POINTS!</h3>
            <p style={{ color: '#cbd5e1', lineHeight: '1.6', margin: '0 0 12px 0' }}>These teams earn <strong>FULL POINTS</strong> (not divided by 2):</p>
            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
              {oot6Constructors.map(c => <span key={c} style={{ background: 'rgba(168, 85, 247, 0.2)', color: '#c084fc', padding: '4px 12px', borderRadius: '999px', fontSize: '13px', fontWeight: '600' }}>{c}</span>)}
            </div>
          </div>

          <div style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '20px' }}>
            <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 12px 0', color: '#f87171' }}>‚ö†Ô∏è Important Rules</h3>
            <ul style={{ color: '#cbd5e1', lineHeight: '1.8', margin: 0, paddingLeft: '20px' }}>
              <li>Each driver can only be picked <strong>ONCE</strong> per season</li>
              <li>Each constructor can only be picked <strong>ONCE</strong> per season</li>
              <li>Picks lock before each race - make your picks early!</li>
              <li><strong>Grand Prix races</strong> count for season points (P1 = 27 pts to P22 = 1 pt)</li>
              <li><strong>Sprint races</strong> do NOT count for season points - only for the $20 weekly sprint bet</li>
              <li>22 Driver races + 2 Constructor races (Canada & Singapore) = 24 total</li>
            </ul>
          </div>

          <div style={{ background: 'rgba(251, 191, 36, 0.1)', border: '1px solid rgba(251, 191, 36, 0.3)', borderRadius: '12px', padding: '20px', marginTop: '16px' }}>
            <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 16px 0', color: '#fbbf24' }}>üí∞ Economics</h3>
            
            <div style={{ marginBottom: '16px' }}>
              <h4 style={{ color: '#fbbf24', margin: '0 0 8px 0' }}>Season Entry Fee: $400</h4>
              <p style={{ color: '#cbd5e1', margin: '0 0 8px 0' }}>Payable at end of season. Payout based on final standings:</p>
              <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                <span style={{ background: 'rgba(251, 191, 36, 0.2)', padding: '4px 12px', borderRadius: '8px', fontSize: '13px' }}>ü•á P1: 45%</span>
                <span style={{ background: 'rgba(156, 163, 175, 0.2)', padding: '4px 12px', borderRadius: '8px', fontSize: '13px' }}>ü•à P2: 20%</span>
                <span style={{ background: 'rgba(251, 146, 60, 0.2)', padding: '4px 12px', borderRadius: '8px', fontSize: '13px' }}>ü•â P3: 15%</span>
                <span style={{ background: 'rgba(71, 85, 105, 0.4)', padding: '4px 12px', borderRadius: '8px', fontSize: '13px' }}>P4: 10%</span>
                <span style={{ background: 'rgba(71, 85, 105, 0.4)', padding: '4px 12px', borderRadius: '8px', fontSize: '13px' }}>P5: 5%</span>
              </div>
            </div>

            <div style={{ marginBottom: '16px' }}>
              <h4 style={{ color: '#4ade80', margin: '0 0 8px 0' }}>Weekly Race Pool: $20 √ó 24 races = $480</h4>
              <p style={{ color: '#94a3b8', margin: 0, fontSize: '14px' }}>Highest finishing position wins. Ties split the pot. No carryovers.</p>
            </div>

            <div style={{ marginBottom: '16px' }}>
              <h4 style={{ color: '#c084fc', margin: '0 0 8px 0' }}>Sprint Race Pool: $20 √ó 6 sprints = $120</h4>
              <p style={{ color: '#94a3b8', margin: 0, fontSize: '14px' }}>Highest finishing position wins. Ties split the pot. No carryovers.</p>
            </div>

            <div style={{ background: 'rgba(251, 191, 36, 0.15)', borderRadius: '8px', padding: '12px', marginTop: '16px' }}>
              <h4 style={{ color: '#fbbf24', margin: '0 0 8px 0' }}>üíµ Total Investment Per Poolie: $1,000</h4>
              <div style={{ color: '#cbd5e1', fontSize: '14px' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}><span>Entry Fee</span><span>$400</span></div>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}><span>Weekly Grand Prix (24)</span><span>$480</span></div>
                <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid rgba(251, 191, 36, 0.3)', paddingBottom: '4px', marginBottom: '4px' }}><span>Sprint Races (6)</span><span>$120</span></div>
                <div style={{ display: 'flex', justifyContent: 'space-between', fontWeight: '700' }}><span>Total</span><span>$1,000</span></div>
              </div>
            </div>
          </div>
        </div>}

        {activeTab === 'economics' && <div style={s.card}>
          <h2 style={{ fontSize: '22px', fontWeight: '700', margin: '0 0 20px 0' }}>üí∞ Economics Dashboard</h2>
          
          {(() => {
            const payingUsers = users.filter(u => !u.justForFun);
            const numPoolies = payingUsers.length;
            const entryFeePool = numPoolies * 400;
            const weeklyPool = numPoolies * 20;
            const sprintPool = numPoolies * 20;
            const totalPool = numPoolies * 1000;
            
            const seasonPayouts = [
              { place: 1, pct: 0.45, label: 'ü•á P1' },
              { place: 2, pct: 0.20, label: 'ü•à P2' },
              { place: 3, pct: 0.15, label: 'ü•â P3' },
              { place: 4, pct: 0.10, label: 'P4' },
              { place: 5, pct: 0.05, label: 'P5' }
            ];
            
            const sortedPayingUsers = [...payingUsers].sort((a, b) => (b.points || 0) - (a.points || 0));
            
            const getRaceWinners = (raceId, isSprint = false) => {
              const race = raceSchedule.find(r => r.id === raceId);
              const result = raceResults[raceId];
              if (!result || !result.driverPositions) return [];
              
              let bestPos = 999;
              let winners = [];
              
              payingUsers.forEach(user => {
                const pick = userPicks[user.id + '-' + raceId];
                if (!pick || !pick.picks) return;
                
                let userBestPos = 999;
                
                if (pick.picks.drivers) {
                  pick.picks.drivers.forEach(driverId => {
                    const driverResult = result.driverPositions[driverId];
                    if (driverResult && driverResult.position > 0 && driverResult.position < userBestPos) {
                      userBestPos = driverResult.position;
                    }
                  });
                }
                
                if (pick.picks.constructor) {
                  const teamDrivers = drivers2026.filter(d => d.Constructors[0].name === pick.picks.constructor);
                  teamDrivers.forEach(d => {
                    const driverResult = result.driverPositions[d.Driver.driverId];
                    if (driverResult && driverResult.position > 0 && driverResult.position < userBestPos) {
                      userBestPos = driverResult.position;
                    }
                  });
                }
                
                if (userBestPos < bestPos) {
                  bestPos = userBestPos;
                  winners = [{ user, pos: userBestPos }];
                } else if (userBestPos === bestPos && userBestPos < 999) {
                  winners.push({ user, pos: userBestPos });
                }
              });
              
              return winners;
            };
            
            const userEarnings = {};
            payingUsers.forEach(u => { userEarnings[u.id] = { season: 0, weekly: 0, sprint: 0, total: 0 }; });
            
            sortedPayingUsers.forEach((user, idx) => {
              if (idx < 5 && seasonPayouts[idx]) {
                userEarnings[user.id].season = Math.round(entryFeePool * seasonPayouts[idx].pct);
              }
            });
            
            const raceWinnersList = [];
            const sprintWinnersList = [];
            
            raceSchedule.forEach(race => {
              const result = raceResults[race.id];
              if (result && result.driverPositions) {
                const winners = getRaceWinners(race.id);
                if (winners.length > 0) {
                  const prize = Math.round(weeklyPool / winners.length);
                  winners.forEach(w => { userEarnings[w.user.id].weekly += prize; });
                  raceWinnersList.push({ race, winners, prize });
                }
                
                if (race.sprint) {
                  const sprintWinners = getRaceWinners(race.id, true);
                  if (sprintWinners.length > 0) {
                    const sprintPrize = Math.round(sprintPool / sprintWinners.length);
                    sprintWinners.forEach(w => { userEarnings[w.user.id].sprint += sprintPrize; });
                    sprintWinnersList.push({ race, winners: sprintWinners, prize: sprintPrize });
                  }
                }
              }
            });
            
            payingUsers.forEach(u => {
              userEarnings[u.id].total = userEarnings[u.id].season + userEarnings[u.id].weekly + userEarnings[u.id].sprint - 1000;
            });
            
            return (<div>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '12px', marginBottom: '24px' }}>
                <div style={{ background: 'rgba(251, 191, 36, 0.15)', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                  <div style={{ fontSize: '14px', color: '#94a3b8' }}>Poolies</div>
                  <div style={{ fontSize: '32px', fontWeight: '700', color: '#fbbf24' }}>{numPoolies}</div>
                </div>
                <div style={{ background: 'rgba(74, 222, 128, 0.15)', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                  <div style={{ fontSize: '14px', color: '#94a3b8' }}>Total Pool</div>
                  <div style={{ fontSize: '32px', fontWeight: '700', color: '#4ade80' }}>${totalPool.toLocaleString()}</div>
                </div>
                <div style={{ background: 'rgba(96, 165, 250, 0.15)', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                  <div style={{ fontSize: '14px', color: '#94a3b8' }}>Entry Fee Pool</div>
                  <div style={{ fontSize: '32px', fontWeight: '700', color: '#60a5fa' }}>${entryFeePool.toLocaleString()}</div>
                </div>
              </div>

              <div style={{ background: 'rgba(251, 191, 36, 0.1)', border: '1px solid rgba(251, 191, 36, 0.3)', borderRadius: '12px', padding: '20px', marginBottom: '16px' }}>
                <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 16px 0', color: '#fbbf24' }}>üèÜ Season Standings Payouts</h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {seasonPayouts.map((p, idx) => {
                    const user = sortedPayingUsers[idx];
                    const payout = Math.round(entryFeePool * p.pct);
                    return <div key={p.place} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: 'rgba(71, 85, 105, 0.3)', borderRadius: '8px', padding: '12px' }}>
                      <div><span style={{ fontWeight: '700', marginRight: '12px' }}>{p.label}</span><span style={{ color: user ? '#fff' : '#64748b' }}>{user ? user.nickname : 'TBD'}</span>{user && <span style={{ color: '#94a3b8', marginLeft: '8px' }}>({user.points || 0} pts)</span>}</div>
                      <div style={{ fontWeight: '700', color: '#4ade80' }}>${payout.toLocaleString()}</div>
                    </div>;
                  })}
                </div>
              </div>

              <div style={{ background: 'rgba(74, 222, 128, 0.1)', border: '1px solid rgba(74, 222, 128, 0.3)', borderRadius: '12px', padding: '20px', marginBottom: '16px' }}>
                <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 16px 0', color: '#4ade80' }}>üèÅ Weekly Race Winners (${weeklyPool}/race)</h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', maxHeight: '300px', overflowY: 'auto' }}>
                  {raceSchedule.map(race => {
                    const raceWinner = raceWinnersList.find(r => r.race.id === race.id);
                    const hasResult = raceResults[race.id];
                    return <div key={race.id} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: 'rgba(71, 85, 105, 0.3)', borderRadius: '8px', padding: '10px 12px', fontSize: '14px' }}>
                      <div><span style={{ color: '#94a3b8', marginRight: '8px' }}>R{race.id}</span><span>{race.name}</span></div>
                      {raceWinner ? <div style={{ color: '#4ade80' }}>{raceWinner.winners.map(w => w.user.nickname).join(', ')} (P{raceWinner.winners[0].pos}) - ${raceWinner.prize}</div> : <span style={{ color: '#64748b' }}>{hasResult ? 'No winner' : 'Pending'}</span>}
                    </div>;
                  })}
                </div>
              </div>

              <div style={{ background: 'rgba(168, 85, 247, 0.1)', border: '1px solid rgba(168, 85, 247, 0.3)', borderRadius: '12px', padding: '20px', marginBottom: '16px' }}>
                <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 16px 0', color: '#c084fc' }}>‚ö° Sprint Race Winners (${sprintPool}/sprint)</h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {raceSchedule.filter(r => r.sprint).map(race => {
                    const sprintWinner = sprintWinnersList.find(r => r.race.id === race.id);
                    const hasResult = raceResults[race.id];
                    return <div key={race.id} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: 'rgba(71, 85, 105, 0.3)', borderRadius: '8px', padding: '10px 12px', fontSize: '14px' }}>
                      <div><span style={{ color: '#94a3b8', marginRight: '8px' }}>R{race.id}</span><span>{race.name}</span></div>
                      {sprintWinner ? <div style={{ color: '#c084fc' }}>{sprintWinner.winners.map(w => w.user.nickname).join(', ')} (P{sprintWinner.winners[0].pos}) - ${sprintWinner.prize}</div> : <span style={{ color: '#64748b' }}>{hasResult ? 'No winner' : 'Pending'}</span>}
                    </div>;
                  })}
                </div>
              </div>

              <div style={{ background: 'rgba(51, 65, 85, 0.4)', borderRadius: '12px', padding: '20px' }}>
                <h3 style={{ fontSize: '18px', fontWeight: '700', margin: '0 0 16px 0' }}>üìä Season Balance Summary</h3>
                <div style={{ overflowX: 'auto' }}>
                  <table style={s.table}>
                    <thead>
                      <tr>
                        <th style={s.th}>Poolie</th>
                        <th style={s.th}>Season</th>
                        <th style={s.th}>Weekly</th>
                        <th style={s.th}>Sprint</th>
                        <th style={s.th}>Investment</th>
                        <th style={s.th}>Balance</th>
                      </tr>
                    </thead>
                    <tbody>
                      {sortedPayingUsers.map(user => {
                        const e = userEarnings[user.id];
                        return <tr key={user.id}>
                          <td style={s.td}><strong>{user.nickname}</strong></td>
                          <td style={s.td}>${e.season.toLocaleString()}</td>
                          <td style={s.td}>${e.weekly.toLocaleString()}</td>
                          <td style={s.td}>${e.sprint.toLocaleString()}</td>
                          <td style={s.td}>-$1,000</td>
                          <td style={{ ...s.td, fontWeight: '700', color: e.total >= 0 ? '#4ade80' : '#f87171' }}>{e.total >= 0 ? '+' : ''}${e.total.toLocaleString()}</td>
                        </tr>;
                      })}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>);
          })()}
        </div>}

        {activeTab === 'drivers' && <div style={s.card}><h2 style={{ fontSize: '22px', fontWeight: '700', margin: '0 0 20px 0' }}>üèéÔ∏è 2026 Drivers</h2><div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>{drivers2026.map(d => { const name = d.Driver.givenName + ' ' + d.Driver.familyName; const teamColor = getTeamColor(d.Constructors[0].name); return <div key={d.Driver.driverId} style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '14px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}><div style={{ display: 'flex', alignItems: 'center', gap: '14px' }}><DriverPhoto driver={{ driverId: d.Driver.driverId, givenName: d.Driver.givenName, familyName: d.Driver.familyName, Constructors: d.Constructors }} size={48} /><div><div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}><span style={{ fontWeight: '700' }}>{name}</span><span style={{ background: teamColor, color: '#fff', padding: '2px 8px', borderRadius: '4px', fontSize: '12px', fontWeight: '700' }}>#{d.Driver.driverId}</span>{isOOTT(name) && <span>‚≠ê</span>}</div><p style={{ fontSize: '13px', margin: '2px 0 0 0', color: teamColor, fontWeight: '600' }}>{d.Constructors[0].name}</p></div></div>{isOOTT(name) && <span style={{ ...s.badge, background: 'rgba(74, 222, 128, 0.2)', color: '#4ade80' }}>OOTT 2x</span>}</div>; })}</div></div>}
        {activeTab === 'teams' && <div style={s.card}><h2 style={{ fontSize: '22px', fontWeight: '700', margin: '0 0 20px 0' }}>üèÅ 2026 Teams</h2><div style={{ display: 'flex', flexDirection: 'column', gap: '14px' }}>{constructors2026.map(c => { const teamDrivers = drivers2026.filter(d => d.Constructors[0].name === c.Constructor.name); const teamColor = getTeamColor(c.Constructor.name); return <div key={c.Constructor.constructorId} style={{ background: 'rgba(51, 65, 85, 0.3)', borderRadius: '12px', padding: '16px', borderLeft: `4px solid ${teamColor}` }}><div style={{ display: 'flex', alignItems: 'center', gap: '14px', marginBottom: '12px' }}><TeamLogo team={c.Constructor.name} size={56} /><div style={{ flex: 1 }}><div style={{ display: 'flex', alignItems: 'center', gap: '10px', flexWrap: 'wrap' }}><span style={{ fontWeight: '700', fontSize: '18px', color: teamColor }}>{c.Constructor.name}</span><span style={{ background: 'rgba(71, 85, 105, 0.5)', color: '#94a3b8', padding: '2px 8px', borderRadius: '4px', fontSize: '12px' }}>#{c.position}</span>{isOOT6(c.Constructor.name) && <span style={{ ...s.badge, background: '#7c3aed' }}>OOT6 2x</span>}</div><p style={{ color: '#94a3b8', fontSize: '13px', margin: '4px 0 0 0' }}>Engine: {c.engine}</p></div></div><div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>{teamDrivers.map(d => { const name = d.Driver.givenName + ' ' + d.Driver.familyName; return <div key={d.Driver.driverId} style={{ background: 'rgba(71, 85, 105, 0.3)', borderRadius: '8px', padding: '10px', display: 'flex', alignItems: 'center', gap: '10px' }}><DriverPhoto driver={{ driverId: d.Driver.driverId, givenName: d.Driver.givenName, familyName: d.Driver.familyName, Constructors: d.Constructors }} size={36} /><div><span style={{ fontWeight: '600', fontSize: '14px' }}>{name}</span>{isOOTT(name) && <span style={{ marginLeft: '4px' }}>‚≠ê</span>}</div></div>; })}</div></div>; })}</div></div>}
      </main>
      <footer style={{ background: 'rgba(30, 41, 59, 0.5)', borderTop: '1px solid rgba(71, 85, 105, 0.3)', padding: '20px', marginTop: '20px', textAlign: 'center' }}><p style={{ color: '#64748b', fontSize: '14px', margin: 0 }}>My Other Car is the Safety Car ‚Ä¢ 2026 Season</p></footer>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
